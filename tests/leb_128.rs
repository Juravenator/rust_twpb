#[test]
fn test_leb128() {
    // Example value 300
    // https://developers.google.com/protocol-buffers/docs/encoding#varints
    let val = ::twpb::decoder::leb128_u32([0xAC, 0x02].iter()).unwrap();
    assert_eq!(val, 300);

    let val = ::twpb::decoder::leb128_i32([0xBB, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x01].iter()).unwrap();
    assert_eq!(val, -69);

    let val = ::twpb::decoder::leb128_i64([0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01].iter()).unwrap();
    assert_eq!(val, i64::MIN);
}

#[test]
fn test_leb128_overflows() {
    // encoded i64::MIN
    ::twpb::decoder::leb128_i32([0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01].iter()).unwrap_err();
    ::twpb::decoder::leb128_u32([0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01].iter()).unwrap_err();
}